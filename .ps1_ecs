__prompt() {
    local string=$1

    PS1+="${string}"
}

__prompt_command() {
    local EXIT="$?"

    PS1=""

    __prompt "\n"

    __prompt "[${EXIT}]"

    __prompt " "

    # show how long the last command took to run
    __prompt "\${timer_show}"

    __prompt " "

    # YYYY-MM-DD HH:MM:SS
    __prompt "\D{%F %T}"

    __prompt " "

    # username and host
    __prompt "\u@\h "

    # cwd
    __prompt "\w"

    __prompt "\n  "


    __prompt "> "
}


function timer_result() {
    ((h=${1}/3600))
    ((m=(${1}%3600)/60))
    ((s=${1}%60))

    if [ "${m}" = "0" ] && [ "${h}" = "0" ]; then
	printf "(%02d)" $s
    elif [ "${h}" = "0" ]; then
	printf "(%02d:%02d)" $m $s
    else
	printf "(%02d:%02d:%02d)" $h $m $s
    fi
}

function timer_start {
  timer=${timer:-$SECONDS}
}

function timer_stop {
  timer_show=$(timer_result $(($SECONDS - $timer)))
  unset timer
}

trap 'timer_start' DEBUG

PROMPT_COMMAND="__prompt_command; timer_stop"
